<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <title>OAuth Callback (tạm)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: system-ui, sans-serif;
        margin: 2rem;
        line-height: 1.5;
      }
      input,
      button,
      textarea {
        font: inherit;
        padding: 0.5rem;
      }
      code,
      pre {
        background: #f5f5f5;
        padding: 0.25rem 0.4rem;
        border-radius: 6px;
      }
    </style>
  </head>
  <body>
    <h1>Google OAuth Callback (tạm)</h1>
    <p>Trang này chỉ để <b>bắt code/state</b> và gửi về API link.</p>

    <div id="info"></div>

    <h3>Nhập JWT (token của tài khoản đang đăng nhập)</h3>
    <input
      id="jwt"
      type="text"
      placeholder="Bearer JWT..."
      style="width: 100%"
    />
    <p><small>Có thể dán token sau khi login qua API thông thường.</small></p>

    <button id="send">Gửi POST /api/v1/auth/oauth/me/link-oauth/google</button>
    <pre id="resp" style="margin-top: 1rem; white-space: pre-wrap"></pre>

    <script>
      const qs = new URLSearchParams(location.search);
      const code = qs.get("code");
      const state = qs.get("state");

      document.getElementById("info").innerHTML = `<p><b>code</b>: <code>${
        code || "(không có)"
      }</code></p>
       <p><b>state</b>: <code>${state || "(không có)"}</code></p>
       <p>Nếu hai giá trị trên bị trống, hãy kiểm tra lại Redirect URI.</p>`;

      document.getElementById("send").onclick = async () => {
        const token = document.getElementById("jwt").value.trim();
        if (!token) {
          alert("Dán JWT vào ô phía trên.");
          return;
        }
        if (!code || !state) {
          alert("Thiếu code/state trên URL.");
          return;
        }

        const res = await fetch("/api/v1/auth/oauth/me/link-oauth/google", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify({ code, state }),
        });
        const text = await res.text();
        document.getElementById("resp").textContent =
          `HTTP ${res.status}\n` + text;
      };
    </script>
  </body>
</html>
